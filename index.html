<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>熔岩番剧库 - 番剧索引 | LavaAnime</title>
    <script src="https://s-sh-2164-assets.oss.dogecdn.com/cdn/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://s-sh-2164-assets.oss.dogecdn.com/cdn/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <script src="https://s-sh-2164-assets.oss.dogecdn.com/cdn/bootstrap/5.1.3/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://s-sh-2164-assets.oss.dogecdn.com/cdn/bootstarp-icon/1.7.2/bootstrap-icons.css">
    <script src="https://s-sh-2164-assets.oss.dogecdn.com/cdn/clipboard/2.0.9/clipboard.min.js"></script>
    <!-- Assets -->
    <link href="./style/scrollbar.css" rel="stylesheet" crossorigin="anonymous">
    </link>
    <script src="./js/mySort.js" crossorigin="anonymous"></script>
    <script src="./js/getUrlParams.js" crossorigin="anonymous"></script>
    <script src="./js/Anime.js" crossorigin="anonymous"></script>
    <script src="./js/Navbar.js" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            // 识别参数，决定自动选择新番还是指定目录
            if (Object.prototype.isPrototypeOf(getUrlParams()) && Object.keys(getUrlParams()).length === 0) { // 如果没有参数，则自动选择新番
                defaultYear = 2022
                defaultMonth = "1月冬"
            } else { // 从地址栏获取应该打开的目录
                defaultYear = decodeURI(getUrlParams().year)
                defaultMonth = decodeURI(getUrlParams().month)
            }

            let buttonHtml = `<li class="page-item year-btn"><a class="page-link">正在取得年代列表...</a></li>` // 提前插入一个按钮, 优化视觉体验, 防止加载抽动
            $("#years").empty().append(buttonHtml) // 插入按钮

            // 界面加载后，获取年代列表
            $.ajax({
                url: 'https://anime-api.5t5.top/v1/index/list/year',
                success: (result) => {
                    if (result.code == 0) {
                        let yearList = result.data
                        // 将年代列表添加到界面
                        let buttonHtml = ''
                        for (i in yearList) {
                            let thisYearDisplay = yearList[i].replace(/年/g, '')
                            let thisYear = yearList[i]
                            buttonHtml = buttonHtml +
                                `<li id="${thisYear}" class="page-item year-btn" style="min-width: fit-content;"><a class="page-link">${thisYearDisplay}</a></li>`
                        }
                        $("#years").empty().hide().append(buttonHtml).fadeIn(500)
                        $('.year-btn').on('click', function () { // 点击年代按钮的事件
                            $(this).addClass('active').siblings().removeClass('active') // 选中样式
                            getMonthList(this.id) // 获取月份列表
                        })
                        $(`#${defaultYear}年`).click() // 点击默认年
                    }
                    else {
                        let buttonHtml = `<li class="page-item year-btn"><a class="page-link">取得年代列表时失败, 建议刷新重试.</a></li>`
                        $("#years").empty().append(buttonHtml)
                    }
                }
            })

            function getMonthList(year) { // 获取月份列表
                $('#month').empty().append(`<liclass="page-item month-btn"><a class="page-link">正在取得季度列表...</a></li>`) // 优化加载时的效果, 防止抽动
                $.ajax({
                    url: 'https://anime-api.5t5.top/v1/index/list/month/' + year,
                    success: (result) => {
                        if (result.code == 0) {
                            let buttonHtml = ''
                            for (i in result.data) {
                                let thisMonth = result.data[i]
                                buttonHtml = buttonHtml +
                                    `<li id="${thisMonth}" class="page-item month-btn" style="min-width: fit-content;"><a class="page-link">${thisMonth}</a></li>`
                            }
                            $("#month").empty().hide().append(buttonHtml).fadeIn(500)
                            $('.month-btn').on('click', function () { // 点击月份按钮的事件
                                $(this).addClass('active').siblings().removeClass('active') // 选中样式
                                let backParams = `year=${year.replace(/年/g, '')}&month=${this.id}`
                                history.pushState({}, {}, `index.html?${backParams}`); // 更新地址栏
                                $('#posters').hide()
                                setTimeout(() => { $('#posters').fadeIn(300) }, 500); // 番剧列表动画
                                printAnimeList('posters', year.replace(/年/g, ''), this.id, backParams) // 打印番剧列表
                            })
                            if (year == `${defaultYear}年`) { // 如果现在选中的年份是默认年份
                                $(`#${defaultMonth}`).click() // 继续点击默认月份
                                defaultYear = '' // 确保不是用户点击
                            }
                        }
                    }
                })
            }
        });
    </script>
</head>

<body>
    <div id="navbar"></div>
    <div class="container mt-4">
        <div class="mx-3">
            <h1 class="display-3">番剧索引</h1>
            <h5 class="lead">年代</h5>
            <ul class="pagination pagination-sm overflow-scroll mb-2" style="max-width: 100%;" id="years"></ul>
            <h5 class="lead">季度 / 类型</h5>
            <ul class="pagination pagination-sm overflow-scroll mb-2" style="max-width: 100%;" id="month"></ul>
        </div>
        <div id="posters"></div>
    </div>

    <div style="height: 100px;"></div>
    <img src="https://www.bfcounter.vip/generatepic?userid=ce1d3f3b-ce67-4319-8222-e751f8262b2e" alt="Page Counter"
        class="visually-hidden">
    <span class="visually-hidden">
        <script type="text/javascript" src="https://v1.cnzz.com/z_stat.php?id=1280746775&web_id=1280746775"></script>
    </span>
    <script async defer data-website-id="5aad3d7c-6372-42aa-957e-ed4c945c0d08"
        src="https://umami.magma.ink/umami.js"></script>
</body>


</html>