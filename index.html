<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>熔岩番剧库 - 番剧索引 | LavaAnime</title>
    <script src="https://s-sh-2164-assets.oss.dogecdn.com/cdn/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://s-sh-2164-assets.oss.dogecdn.com/cdn/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://s-sh-2164-assets.oss.dogecdn.com/cdn/bootstrap/5.1.3/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://s-sh-2164-assets.oss.dogecdn.com/cdn/bootstarp-icon/1.7.2/bootstrap-icons.css">
    <script src="https://s-sh-2164-assets.oss.dogecdn.com/cdn/clipboard/2.0.9/clipboard.min.js"></script>
    <!-- Assets -->
    <link href="./style/scrollbar.css" rel="stylesheet" crossorigin="anonymous">
    </link>
    <script src="./js/mySort.js" crossorigin="anonymous"></script>
    <script src="./js/getUrlParams.js" crossorigin="anonymous"></script>
    <script src="./js/Anime.js" crossorigin="anonymous"></script>
    <script src="./js/Navbar.js" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {

            // 定义容器
            containerId = "posters"

            // 界面加载后，隐藏加载中图标
            $("#loading").hide()

            // 识别参数，决定自动选择新番还是指定目录，并且影响打开的番剧播放页返回主页时的决定
            console.log(getUrlParams())
            if (Object.prototype.isPrototypeOf(getUrlParams()) && Object.keys(getUrlParams()).length === 0) {
                // 默认选中的筛选
                var backParams = ''
                var defaultYear = 2022
                var defaultMonth = "1月冬"
            }
            else {
                var backParams = 'year=' + getUrlParams().year + '&' + 'month=' + getUrlParams().month
                var defaultYear = getUrlParams().year
                var defaultMonth = decodeURI(getUrlParams().month)
            }


            // 界面加载后，获取年代列表
            $.ajax({
                url: "https://dav.5t5.top/api/v3/share/list/jqMFl/",
                success: function (result) {
                    // 解壳
                    var objects = result.data.objects
                    // 新建一个数组用于排序
                    var yearSorter = new Array()
                    // 将得到的每个文件夹的名字写进数组
                    for (var i = 0; i < objects.length; i++) {
                        yearSorter[i] = objects[i].name
                    }
                    // 把数组按字母排序再倒序
                    var yearList = yearSorter.sort().reverse()
                    // for 循环写入文档
                    for (var i = 0; i < yearList.length; i++) {
                        // 删去文件夹名字里的“年”
                        yearList[i] = yearList[i].toString();
                        yearList[i] = yearList[i].substring(0, yearList[i].length - 1)
                        //输出html
                        var yearBtnHtml = 
                        `
                        <input type="radio" name="year" class="btn-check btn-year" id="${yearList[i]}">
                            <label style="min-width: max-content;" class="btn btn-outline-primary" for="${yearList[i]}">
                                ${yearList[i]}
                            </label>
                        </button>
                        `
                        $("#years").append(yearBtnHtml)

                    }
                    // 为每个按钮追加点击时触发的函数
                    $(".btn-year").click(function () {
                        // 找出被点击的那个按钮勾
                        var clickedYear = $('input:radio[name="year"]:checked')[0].id
                        // 调用函数
                        getMonthList(clickedYear)
                    })
                    // 自动点击默认年
                    $("#" + defaultYear).trigger("click")
                    setTimeout(() => {
                        $("#" + defaultMonth).trigger("click")
                    }, 500);
                }
            })



            function getMonthList(year) {
                $.ajax({
                    beforeSend: function () {
                        $("#months").empty()
                    },
                    url: "https://dav.5t5.top/api/v3/share/list/jqMFl/" + year + "年",
                    success: function (result) {
                        // 解壳
                        var objects = result.data.objects
                        // 新建一个数组用于排序
                        var monthSorter = new Array()
                        // 将得到的每个文件夹的名字写进数组
                        for (var i = 0; i < objects.length; i++) {
                            monthSorter[i] = objects[i].name
                        }
                        // 把数组按字母排序再倒序
                        var monthList = monthSorter.sort()
                        // console.log(monthList)

                        for (var i = 0; i < monthList.length; i++) {
                            //输出html
                            var monthBtnHtml = 
                            `
                            <input type="radio" name="month" class="btn-check btn-month" id="${monthList[i]}">
                                <label style="min-width: max-content;" class="btn btn-outline-primary" for="${monthList[i]}">
                                    ${monthList[i]}
                                </label>
                            </button>
                            `
                            $("#months").append(monthBtnHtml)
                        }
                        // 为每个按钮追加点击函数
                        $(".btn-month").click(function () {
                            // 定义月变量
                            var clickedMonth = $('input:radio[name="month"]:checked')[0].id
                            // 更新地址栏参数
                            history.pushState({}, {}, "index.html?year=" + year + "&month=" + clickedMonth);
                            // 更新从播放页返回时携带的参数
                            var backParams = 'year=' + getUrlParams().year + '&' + 'month=' + getUrlParams().month
                            $("#" + containerId).hide()
                            $("#" + containerId).show()
                            printAnimeList(containerId, year, clickedMonth, backParams)
                        })
                    }
                })
            }
        });
    </script>
</head>

<body>
    <div id="navbar"></div>




    <div class="container mt-4 mb-5">
        <div class="mx-3">
            <h1 class="display-3">番剧索引</h1>
            <h5 class="lead ">年代</h5>
            <div class="btn-group-sm mb-2 btn-group overflow-scroll" id="years"
                style="padding-left: 1px; max-width: 104%;">

            </div>
            <h5 class="lead">季度 / 类型</h5>
            <div class="btn-group-sm mb-2 btn-group overflow-scroll" id="months"
                style="padding-left: 1px; max-width: 104%;">
            </div>
        </div>

        <div id="posters">
        </div><br>


    </div>
    <img src="https://www.bfcounter.vip/generatepic?userid=ce1d3f3b-ce67-4319-8222-e751f8262b2e" alt="Page Counter"
        class="visually-hidden">
    <span class="visually-hidden">
        <script type="text/javascript" src="https://v1.cnzz.com/z_stat.php?id=1280746775&web_id=1280746775"></script>
    </span>
    <script async defer data-website-id="5aad3d7c-6372-42aa-957e-ed4c945c0d08" src="https://umami.magma.ink/umami.js"></script>
</body>


</html>